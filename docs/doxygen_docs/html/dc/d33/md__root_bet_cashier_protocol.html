<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bet: Cashier Protocol</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Bet"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dc/d33/md__root_bet_cashier_protocol.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Cashier Protocol </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document discusses about how the funds locked and released during the game with the help of notary nodes which are running the cashier protocol.</p>
<p>Notary nodes are the nodes which are elected and trusted by the network. The idea of having notary nodes to lock and release the funds is to remove the control over the funds from the dealer.</p>
<p>Once if the node is trusted and elected as a notary, it runs the cashier protocol server side. The implementation of cashier portocol is present inside the <code>privatebet</code> directory.</p>
<p>### Steps to run a notary node with cashier protocol </p><div class="fragment"><div class="line">./bet cashier</div></div><!-- fragment --><h3>Notary nodes</h3>
<p>The nodes which are trusted in the network are mentioned here. The trusted nodes to demonstrate how the cashier protocol works are mentioned below: </p><div class="fragment"><div class="line">1. 159.69.23.28</div><div class="line">2. 159.69.23.29</div><div class="line">3. 159.69.23.30</div><div class="line">4. 159.69.23.31</div></div><!-- fragment --><p> Each trusted node is associated with the public address which is a part of multisig address to which playing nodes sends the funds during the start of the game.</p>
<p>The notary nodes with their associated <code>P2SH</code> and <code>Pubic Key</code> are as below: </p><div class="fragment"><div class="line">| Node IP      | P2SH                               | Public Key                                                         |</div><div class="line">|--------------|------------------------------------|--------------------------------------------------------------------|</div><div class="line">| 159.69.23.28 | bQepVNtzfjMaBJdaaCq68trQDAPDgKnwrD | 034d2b213240cfb4efcc24cc21a237a2313c0c734a4f0efc30087c095fd010385f |</div><div class="line">| 159.69.23.29 | bSa7CrTXykfPZ6yhThjXAoQ8r4H7muiPPC | 02137b5400ace827c225238765d4661a1b4fe589b9b625b10469c69f0867f7bc53 |</div><div class="line">| 159.69.23.30 | bGmKoyJEz4ESuJCTjhVkgEb2Qkt8QuiQzQ | 03b020866c9efae106e3c086a640e8b50cce7ae91cb30996ecf0f8816ce5ed8f49 |</div><div class="line">| 159.69.23.31 | bR7BXnWT1yVSP9aB57pq22XN2WYNpGgDrD | 0274ae1ce244bd0f9c52edfb6b9e60dc5d22f001dd74af95d1297edbcc8ae39568 |</div></div><!-- fragment --><p>The <code>m of n</code> multisig addresses are generated such a way that <code>m</code> should always be minimum of <code>ceil(n/2)</code> or greater than that. Some of the msig addressess which are generated and preconfigured are mentioned as below: </p><div class="fragment"><div class="line">| m of n | msig address(in legacy representation) | associated addresses                                                                                                                                                                                                                                                                    |</div><div class="line">|--------|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|</div><div class="line">| 2 of 3 | bQJTo8knsbSoU7k9oGADa6qfWGWyJtxC3o     | 1. 034d2b213240cfb4efcc24cc21a237a2313c0c734a4f0efc30087c095fd010385f 2. 02137b5400ace827c225238765d4661a1b4fe589b9b625b10469c69f0867f7bc53 3. 0274ae1ce244bd0f9c52edfb6b9e60dc5d22f001dd74af95d1297edbcc8ae39568                                                                       |</div><div class="line">| 2 of 4 | bRCUpox55j6sFJBuEn9E1fwNLFKFvRvo9W     | 1. 034d2b213240cfb4efcc24cc21a237a2313c0c734a4f0efc30087c095fd010385f 2. 02137b5400ace827c225238765d4661a1b4fe589b9b625b10469c69f0867f7bc53 3. 03b020866c9efae106e3c086a640e8b50cce7ae91cb30996ecf0f8816ce5ed8f49 4. 0274ae1ce244bd0f9c52edfb6b9e60dc5d22f001dd74af95d1297edbcc8ae39568 |</div></div><!-- fragment --><p>When the game starts since all the trusted notary nodes and the corresponding public keys are preconfigured, each playing nodes identifies the notaries which are active that matches to the criteria set by the dealer. Here assume that if the dealer sets <code>2 of 4</code> then each playing node checks if atleast two of the notary nodes are reachable, if so then if the the player has the funds which is greater than or equal to the stack size set by the dealer then the playing node creates an <code>msig tx</code> to deposit the funds and shares this <code>txid</code> to the dealer.</p>
<p>Dealer then verifies whether the <code>tx</code> is legitimate or not as mentioned below: </p><div class="fragment"><div class="line">1. Player sends the joining request, along with it&#39;s {public_key}.</div><div class="line">2. Dealer sends the {stack_size, random_number} to the player.</div><div class="line">3. Player checks if it has sufficient funds to join the table, </div><div class="line">  3.1 if yes,</div><div class="line">    a. check the status of the notary nodes and deposit stack_size amount to the msig_address</div><div class="line">    b. generates the signature for the random_number</div><div class="line">    c. send {signature(random_number), tx} to the dealer</div><div class="line">  3.2 if no, exit, refill the funds(which is done manually to the address in the chips wallet) and join again if the player wants to play.</div><div class="line">4. Dealaer verifies the signature(random_number), if yes it verifies the tx as mentioned in step 5 else discard the message.</div><div class="line">5. Steps to verify the tx.</div><div class="line">  5.1 check if it&#39;s unspent.</div><div class="line">  5.2 check if it&#39;s sent to the already preconfigured msig_address</div><div class="line">  5.3 check if the amount in tx is equals to stack_size</div><div class="line">6. if all checks passed in step 5, dealer sends the join_res  </div></div><!-- fragment --><p>Like this dealer keeps track of the joining players along with lock-in transaction as shown below: </p><div class="fragment"><div class="line">| player_id | tx   |</div><div class="line">|-----------|------|</div><div class="line">| 1         | tx_1 |</div><div class="line">| 2         | tx_2 |</div><div class="line">| ...       | ...  |</div><div class="line">| n         | tx_n |</div></div><!-- fragment --><p>Once the game is done dealer sends the spending request of these transactions to the winning player. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jan 8 2020 09:05:04 for Bet by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
